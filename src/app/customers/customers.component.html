<div class="customers-container">
  <app-header activeRoute="customers"></app-header>

  <main class="customers-content">
    <div class="content-header">
      <h2>Customers</h2>
    </div>

    <div class="customers-actions d-flex justify-content-between align-items-center">
      <div class="search-container flex-grow-1 me-2">
        <input 
          type="text" 
          [(ngModel)]="searchQuery" 
          (input)="searchCustomers()" 
          placeholder="Search by name or Aadhaar"
          class="search-input w-100"
        >
      </div>
      <button 
        class="add-customer-btn btn btn-primary" 
        (click)="openAddCustomerModal()"
        data-bs-toggle="modal" 
        data-bs-target="#customerModal"
      >
        <i class="bi bi-plus-lg"></i>
        <span class="d-none d-md-inline">Add Customer</span>
        <span class="d-md-none">+</span>
      </button>
    </div>

    <div class="customers-grid" *ngIf="customers.length > 0; else noCustomers">
      <div 
        *ngFor="let customer of customers" 
        class="customer-card"
      >
        <div class="customer-card-header">
          <h3>{{ customer.firstName }} {{ customer.lastName }}</h3>
          <div class="customer-card-actions">
            <button 
              class="edit-btn" 
              (click)="openEditCustomerModal(customer)"
              data-bs-toggle="modal" 
              data-bs-target="#customerModal"
            >
              Edit
            </button>
            <button 
              class="delete-btn" 
              (click)="deleteCustomer(customer.id || '')"
            >
              Delete
            </button>
          </div>
        </div>
        <div class="customer-card-details">
          <div class="detail-row">
            <span class="detail-label">Phone:</span>
            <span class="detail-value">{{ customer.phoneNumber }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Aadhaar:</span>
            <span class="detail-value">{{ customer.aadhaarNumber }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Address:</span>
            <span class="detail-value">{{ customer.address }}</span>
          </div>
        </div>
      </div>
    </div>

    <ng-template #noCustomers>
      <div class="no-customers-container">
        <div class="no-customers-content">
          <i class="icon-no-customers"></i>
          <h3>No Customers Found</h3>
          <p>Click "Add Customer" to create your first customer record.</p>
          <button 
            class="add-first-customer-btn" 
            (click)="openAddCustomerModal()"
            data-bs-toggle="modal" 
            data-bs-target="#customerModal"
          >
            Add First Customer
          </button>
        </div>
      </div>
    </ng-template>

    <!-- Customer Modal -->
    <div 
      #customerModal 
      class="modal fade" 
      id="customerModal" 
      tabindex="-1" 
      aria-labelledby="customerModalLabel" 
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="customerModalLabel">
              {{ isEditMode ? 'Edit Customer' : 'Add Customer' }}
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body position-relative" style="max-height: 60vh; overflow-y: auto;">
            <div *ngIf="errorMessage" class="alert alert-danger" role="alert">
              {{ errorMessage }}
            </div>
            <form [formGroup]="customerForm" (ngSubmit)="submitCustomer()" style="padding-right: 15px;">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="firstName" class="form-label">First Name</label>
                  <input 
                    type="text" 
                    class="form-control" 
                    id="firstName" 
                    formControlName="firstName"
                    [ngClass]="{'is-invalid': firstName?.invalid && (firstName?.dirty || firstName?.touched)}"
                  >
                  <div *ngIf="firstName?.invalid && (firstName?.dirty || firstName?.touched)" class="invalid-feedback">
                    First name is required and must be at least 2 characters.
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="lastName" class="form-label">Last Name</label>
                  <input 
                    type="text" 
                    class="form-control" 
                    id="lastName" 
                    formControlName="lastName"
                    [ngClass]="{'is-invalid': lastName?.invalid && (lastName?.dirty || lastName?.touched)}"
                  >
                  <div *ngIf="lastName?.invalid && (lastName?.dirty || lastName?.touched)" class="invalid-feedback">
                    Last name is required and must be at least 2 characters.
                  </div>
                </div>
                
                <!-- Phone Number -->
                <div class="col-md-6 mb-3">
                  <label for="phoneNumber" class="form-label">Phone Number</label>
                  <input 
                    type="tel" 
                    class="form-control" 
                    id="phoneNumber" 
                    formControlName="phoneNumber"
                    [ngClass]="{'is-invalid': phoneNumberErrors}"
                  >
                  <div *ngIf="phoneNumberErrors" class="invalid-feedback">
                    Please enter a valid 10-digit phone number.
                  </div>
                </div>
                
                <!-- Aadhaar Number -->
                <div class="col-md-6 mb-3">
                  <label for="aadhaarNumber" class="form-label">Aadhaar Number</label>
                  <input 
                    type="text" 
                    class="form-control" 
                    id="aadhaarNumber" 
                    formControlName="aadhaarNumber"
                    [ngClass]="{'is-invalid': aadhaarNumberErrors}"
                  >
                  <div *ngIf="aadhaarNumberErrors" class="invalid-feedback">
                    Please enter a valid 12-digit Aadhaar number.
                  </div>
                </div>
                
                <!-- Address Fields -->
                <div formGroupName="address">
                  <div class="col-12 mb-3">
                    <label for="street" class="form-label">Street Address</label>
                    <input 
                      type="text" 
                      class="form-control" 
                      id="street" 
                      formControlName="street"
                      [ngClass]="{'is-invalid': streetErrors}"
                    >
                    <div *ngIf="streetErrors" class="invalid-feedback">
                      Please enter a valid street address.
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-md-4 mb-3">
                      <label for="city" class="form-label">City</label>
                      <input 
                        type="text" 
                        class="form-control" 
                        id="city" 
                        formControlName="city"
                        [ngClass]="{'is-invalid': cityErrors}"
                      >
                      <div *ngIf="cityErrors" class="invalid-feedback">
                        Please enter a valid city name.
                      </div>
                    </div>
                    
                    <div class="col-md-4 mb-3">
                      <label for="state" class="form-label">State</label>
                      <input 
                        type="text" 
                        class="form-control" 
                        id="state" 
                        formControlName="state"
                        [ngClass]="{'is-invalid': stateErrors}"
                      >
                      <div *ngIf="stateErrors" class="invalid-feedback">
                        Please enter a valid state name.
                      </div>
                    </div>
                    
                    <div class="col-md-4 mb-3">
                      <label for="pinCode" class="form-label">Pin Code</label>
                      <input 
                        type="text" 
                        class="form-control" 
                        id="pinCode" 
                        formControlName="pinCode"
                        [ngClass]="{'is-invalid': pinCodeErrors}"
                      >
                      <div *ngIf="pinCodeErrors" class="invalid-feedback">
                        Please enter a valid 6-digit pin code.
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button 
              type="submit" 
              class="btn btn-primary" 
              [disabled]="customerForm.invalid"
              (click)="submitCustomer()"
            >
              {{ isEditMode ? 'Update Customer' : 'Add Customer' }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
